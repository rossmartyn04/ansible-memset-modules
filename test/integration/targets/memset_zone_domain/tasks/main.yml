---
- name: create domain with incorrect API key
  local_action:
    module: memset_zone_domain
    api_key: "wa9aerahhie0eekee9iaphoorovooyia"
    state: present
    domain: "{{ test_domain }}"
    zone: "{{ target_zone }}"
  ignore_errors: true
  register: result

- assert:
    that:
      - result.failed
      - "'ApiErrorForbidden' in result.stdout"

- name: create domain over 250 chars
  local_action:
    module: memset_zone_domain
    api_key: "{{ api_key }}"
    state: present
    domain: 'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa.com'
    zone: "{{ target_zone }}"
  ignore_errors: true
  register: result

- assert:
    that:
      - result.failed
      - "'Zone domain must be less than 250 characters in length' in result.stdout"

- name: create domain in non-existent zone
  local_action:
    module: memset_zone_domain
    api_key: "{{ api_key }}"
    state: present
    domain: "{{ test_domain }}"
    zone: "non-existent-zone"
  ignore_errors: true
  register: result

- assert:
    that:
      - result.failed
      - "'DNS zone \'non-existent-zone\' does not exist, cannot create domain.' in result.stdout"

- name: create domain in non-unique zone
  local_action:
    module: memset_zone_domain
    api_key: "{{ api_key }}"
    state: present
    domain: "{{ test_domain }}"
    zone: "{{ duplicate_zone }}"
  ignore_errors: true
  register: result

- assert:
    that:
      - result.failed
      - "'non-existent-zone matches multiple zones, cannot create domain' in result.stdout"

- name: test creating domain
  local_action:
    module: memset_zone_domain
    api_key: "{{ api_key }}"
    state: present
    domain: "{{ test_domain }}"
    zone: "{{ target_zone }}"
  check_mode: true
  register: result

- assert:
    that:
      - result.changed
      - result.check_mode == true

- name: create domain
  local_action:
    module: memset_zone_domain
    api_key: "{{ api_key }}"
    state: present
    domain: "{{ test_domain }}"
    zone: "{{ target_zone }}"
  register: result

- assert:
    that:
      - result.changed

- name: create existing domain
  local_action:
    module: memset_zone_domain
    api_key: "{{ api_key }}"
    state: present
    domain: "{{ test_domain }}"
    zone: "{{ target_zone }}"
  register: result

- assert:
    that:
      - not result.changed

- name: test deleting domain
  local_action:
    module: memset_zone_domain
    api_key: "{{ api_key }}"
    state: absent
    domain: "{{ test_domain }}"
    zone: "{{ target_zone }}"
  check_mode: true
  register: result

- assert:
    that:
      - result.changed
      - result.check_mode == true

- name: delete domain
  local_action:
    module: memset_zone_domain
    api_key: "{{ api_key }}"
    state: absent
    domain: "{{ test_domain }}"
    zone: "{{ target_zone }}"
  register: result

- assert:
    that:
      - result.changed

- name: delete non-existent domain
  local_action:
    module: memset_zone_domain
    api_key: "{{ api_key }}"
    state: absent
    domain: "{{ test_domain }}"
    zone: "{{ target_zone }}"
  register: result

- assert:
    that:
      - not result.changed